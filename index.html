<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Ramanujan's DOB Magic Square</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #e0e7ff;
            color: #111;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }

        .app {
            width: 95vw;
            max-width: 500px;
            background: #fff;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.3s ease;
        }

        .app:hover {
            transform: translateY(-3px);
        }

        h1 {
            text-align: center;
            font-size: 20px;
            margin-bottom: 14px;
            color: #1e3a8a;
        }

        label {
            font-size: 14px;
            align-self: flex-start;
            margin-bottom: 4px;
            font-weight: 500;
        }

        input[type=date] {
            width: 100%;
            padding: 8px;
            margin-bottom: 14px;
            border: 1px solid #c7d2fe;
            border-radius: 8px;
            font-size: 14px;
            transition: border 0.2s, box-shadow 0.2s;
        }

        input[type=date]:focus {
            border-color: #6366f1;
            box-shadow: 0 0 5px rgba(99, 102, 241, 0.4);
            outline: none;
        }

        button {
            background: #4f46e5;
            border: none;
            padding: 10px 16px;
            border-radius: 10px;
            color: #fff;
            cursor: pointer;
            width: 100%;
            font-size: 15px;
            font-weight: 600;
            transition: background 0.2s, transform 0.2s;
        }

        button:hover {
            background: #4338ca;
            transform: translateY(-2px);
        }

        .matrix-container {
            width: 100%;
            margin-top: 20px;
        }

        .matrix {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            width: 100%;
        }

        .cell {
            background: #1e293b;
            color: #fefefe;
            font-weight: 700;
            text-align: center;
            border-radius: 16px;
            aspect-ratio: 1/1;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
            opacity: 0;
            transform: scale(0.5);
            transition: transform 0.6s ease-out, opacity 0.6s ease-out;
        }

        .cell.show {
            opacity: 1;
            transform: scale(1);
        }

        .cell:hover,
        .cell.touch-active {
            transform: scale(1.05);
        }

        .cell.highlight {
            background: #464347 !important;
            color: #fff;
        }

        .meta {
            text-align: center;
            margin-top: 16px;
            font-size: 15px;
            color: #374151;
            font-weight: 500;
        }

        /* Accordion */
        .accordion {
            width: 100%;
            margin-top: 16px;
            border: 1px solid #c7d2fe;
            border-radius: 12px;
            overflow: hidden;
        }

        .accordion-item {
            border-bottom: 1px solid #c7d2fe;
        }

        .accordion-item:last-child {
            border-bottom: none;
        }

        .accordion-header {
            background: #e0e7ff;
            cursor: pointer;
            padding: 10px 16px;
            font-weight: 600;
            color: #1e3a8a;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }

        .accordion-header:hover {
            background: #dbeafe;
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
            background: #f8fafc;
            padding: 0 16px;
        }

        .accordion-content ul {
            padding: 10px 0;
            margin: 0;
            list-style: disc;
            margin-left: 20px;
        }

        .accordion-content.show {
            padding: 10px 16px;
            max-height: 500px;
        }

        @keyframes softBounce {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }

            40% {
                transform: scale(1.05);
                opacity: 1;
            }

            60% {
                transform: scale(0.95);
            }

            80% {
                transform: scale(1.02);
            }

            100% {
                transform: scale(1);
            }
        }

        .bounce {
            animation: softBounce 1s ease-out;
        }
    </style>
</head>

<body>
    <div class="app">
        <h1>✨ Ramanujan's DOB Magic Square ✨</h1>
        <label for="dob">Date of Birth:</label>
        <input id="dob" type="date" value="1887-12-22" />
        <button id="make">Generate Magic Square</button>
        <div class="matrix-container">
            <div class="matrix" id="matrix"></div>
        </div>
        <div class="meta">Magic constant: <strong id="magic">—</strong></div>

        <!-- Accordion -->
        <div class="accordion">
            <div class="accordion-item">
                <div class="accordion-header">Magic Square Features <span>▼</span></div>
                <div class="accordion-content">
                    <ul>
                        <li>4×4 grid based on your DOB</li>
                        <li>Sum of each row equals magic constant</li>
                        <li>Sum of each column equals magic constant</li>
                        <li>Sum of both diagonals equals magic constant</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        const dobEl = document.getElementById('dob');
        const makeBtn = document.getElementById('make');
        const matrixEl = document.getElementById('matrix');
        const magicEl = document.getElementById('magic');

        function splitYear(y) { return [Math.floor(y / 100), y % 100]; }

        function generateFromDate(dateStr) {
            if (!dateStr) return null;
            const d = new Date(dateStr);
            if (Number.isNaN(d.getTime())) return null;
            const DD = d.getDate(), MM = d.getMonth() + 1, YYYY = d.getFullYear();
            const [YY1, YY2] = splitYear(YYYY);
            return [DD, MM, YY1, YY2, YY2 + 1, YY1 - 1, MM - 3, DD + 3, MM - 2, DD + 2, YY2 + 2, YY1 - 2, YY1 + 1, YY2 - 1, DD + 1, MM - 1];
        }

        function fitFont(div) { div.style.fontSize = div.clientHeight * 0.2 + 'px'; }

        function render(grid) {
            matrixEl.innerHTML = '';
            const cells = [];
            for (let r = 0; r < 4; r++) {
                for (let c = 0; c < 4; c++) {
                    const index = r * 4 + c;
                    const div = document.createElement('div');
                    div.className = 'cell';
                    div.textContent = grid[index];
                    div.dataset.row = r;
                    div.dataset.col = c;
                    div.dataset.index = index;

                    div.addEventListener('touchstart', () => div.classList.add('touch-active'));
                    div.addEventListener('touchend', () => div.classList.remove('touch-active'));
                    div.addEventListener('click', () => {
                        cells.forEach(c => c.classList.remove('highlight'));
                        div.classList.add('highlight');
                        if (navigator.vibrate) navigator.vibrate(50);
                        div.classList.remove('bounce'); void div.offsetWidth; div.classList.add('bounce');
                    });

                    matrixEl.appendChild(div);
                    setTimeout(() => { div.classList.add('show'); div.classList.add('bounce'); setTimeout(() => div.classList.remove('bounce'), 1000); }, r * 400 + c * 250);

                    cells.push(div);
                }
            }

            document.querySelectorAll('.cell').forEach(fitFont);

            const rows = [];
            for (let r = 0; r < 4; r++) rows.push(grid.slice(r * 4, (r + 1) * 4).reduce((a, b) => a + b, 0));
            const magicConst = rows[0];
            magicEl.textContent = magicConst;
            window.speechSynthesis.speak(new SpeechSynthesisUtterance(`Magic constant is ${magicConst}`));
        }

        makeBtn.addEventListener('click', () => {
            const grid = generateFromDate(dobEl.value);
            if (!grid) { alert('Please pick a valid date'); return; }
            render(grid);

            const accordionContent = document.querySelector('.accordion-content');
            const accordionHeader = document.querySelector('.accordion-header');
            accordionContent.classList.add('show');
            accordionHeader.querySelector('span').textContent = '▲';
        });

        window.addEventListener('resize', () => { document.querySelectorAll('.cell').forEach(fitFont); });

        document.querySelectorAll('.accordion-header').forEach(header => {
            header.addEventListener('click', () => {
                const content = header.nextElementSibling;
                content.classList.toggle('show');
                header.querySelector('span').textContent = content.classList.contains('show') ? '▲' : '▼';
            });
        });
    </script>
</body>

</html>
