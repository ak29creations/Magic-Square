<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DOB Magic Square</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #e0e7ff;
      color: #111;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px;
    }
    .app {
      width: 95vw;
      max-width: 500px;
      background: #fff;
      border-radius: 16px;
      padding: 25px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.12);
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: transform 0.2s;
    }
    .app:hover {
      transform: translateY(-3px);
    }
    h1 {
      text-align: center;
      font-size: 20px;
      margin-bottom: 14px;
      color: #1e3a8a;
    }
    label {
      font-size: 14px;
      align-self: flex-start;
      margin-bottom: 4px;
      font-weight: 500;
    }
    input[type=date] {
      width: 100%;
      padding: 8px;
      margin-bottom: 14px;
      border: 1px solid #c7d2fe;
      border-radius: 8px;
      font-size: 14px;
      transition: border 0.2s, box-shadow 0.2s;
    }
    input[type=date]:focus {
      border-color: #6366f1;
      box-shadow: 0 0 5px rgba(99,102,241,0.4);
      outline: none;
    }
    button {
      background: #4f46e5;
      border: none;
      padding: 10px 16px;
      border-radius: 10px;
      color: #fff;
      cursor: pointer;
      width: 100%;
      font-size: 15px;
      font-weight: 600;
      transition: background 0.2s, transform 0.2s;
    }
    button:hover {
      background: #4338ca;
      transform: translateY(-2px);
    }
    .matrix-container {
      width: 100%;
      margin-top: 20px;
    }
    .matrix {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      width: 100%;
    }
    .cell {
      background: #1e293b;
      color: #fefefe;
      font-weight: 700;
      text-align: center;
      border-radius: 16px;
      aspect-ratio: 1 / 1;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: default;
      font-size: 1.2rem;
      box-shadow: 0 3px 8px rgba(0,0,0,0.15);
      opacity: 0;           /* start hidden for animation */
      transform: scale(0.5); /* start smaller */
      transition: transform 0.4s ease, opacity 0.4s ease;
    }
    .cell.show {
      opacity: 1;
      transform: scale(1);
    }
    .cell:hover,
    .cell.touch-active {
      background: #374151;
      transform: scale(1.05);
    }
    .meta {
      text-align: center;
      margin-top: 16px;
      font-size: 15px;
      color: #374151;
      font-weight: 500;
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>✨ DOB Magic Square ✨</h1>
    <label for="dob">Date of Birth:</label>
    <input id="dob" type="date" value="1992-08-14" />
    <button id="make">Generate Magic Square</button>
    <div class="matrix-container">
      <div class="matrix" id="matrix"></div>
    </div>
    <div class="meta">Magic constant: <strong id="magic">—</strong></div>
  </div>

  <script>
    const dobEl = document.getElementById('dob');
    const makeBtn = document.getElementById('make');
    const matrixEl = document.getElementById('matrix');
    const magicEl = document.getElementById('magic');

    function splitYear(y){
      const yy1 = Math.floor(y/100);
      const yy2 = y % 100;
      return [yy1, yy2];
    }

    function generateFromDate(dateStr){
      if(!dateStr) return null;
      const d = new Date(dateStr);
      if(Number.isNaN(d.getTime())) return null;
      const DD = d.getDate();
      const MM = d.getMonth()+1;
      const YYYY = d.getFullYear();
      const [YY1, YY2] = splitYear(YYYY);

      const r1 = [DD, MM, YY1, YY2];
      const r2 = [YY2 + 1, YY1 - 1, MM - 3, DD + 3];
      const r3 = [MM - 2, DD + 2, YY2 + 2, YY1 - 2];
      const r4 = [YY1 + 1, YY2 - 1, DD + 1, MM - 1];
      return [ ...r1, ...r2, ...r3, ...r4 ];
    }

    function fitFont(div){
      const parentSize = div.clientHeight * 0.2; 
      div.style.fontSize = parentSize + 'px';
    }

    function render(grid){
      matrixEl.innerHTML = '';
      grid.forEach((v, index) => {
        const div = document.createElement('div');
        div.className = 'cell';
        div.textContent = v;

        div.addEventListener('touchstart', () => div.classList.add('touch-active'));
        div.addEventListener('touchend', () => div.classList.remove('touch-active'));

        matrixEl.appendChild(div);

        // Animate with delay for pop-in effect
        setTimeout(() => {
          div.classList.add('show');
        }, index * 70); // stagger each cell by 70ms
      });

      document.querySelectorAll('.cell').forEach(fitFont);

      const rows = [];
      for(let r=0; r<4; r++)
        rows.push(grid.slice(r*4, (r+1)*4).reduce((a,b)=>a+b,0));
      const magicConst = rows[0];
      magicEl.textContent = magicConst;

      const msg = new SpeechSynthesisUtterance(`Magic constant is ${magicConst}`);
      window.speechSynthesis.speak(msg);
    }

    makeBtn.addEventListener('click', ()=>{
      const grid = generateFromDate(dobEl.value);
      if(!grid){
        alert('Please pick a valid date');
        return;
      }
      render(grid);
    });

    window.addEventListener('resize', () => {
      document.querySelectorAll('.cell').forEach(fitFont);
    });
  </script>
</body>
</html>
